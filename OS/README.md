# 운영체제

- [프로세스와 스레드](#프로세스와-스레드)
- [멀티 스레드](#멀티-스레드)

## 프로세스와 스레드

> 프로세스(Process) 실행 중인 프로그램이 메모리에 적재 되어 CPU의 할당을 받는 것. 스레드(Thread)는 프로세스의 실행 단위.
> 프로세스 제어 블록(Process Control Block, PCB)은 OS 자료구조로 프로세스에 대한 중요한 정보를 저장한다. 프로세스 생성 = 고유한 PCB 생성

1. 프로세스 : OS로 부터 주소 공간, 파일, 메모리 등을 할당 받으며 이것들을 총칭한다. 프로세스 스택(함수의 매개변수, 복귀 주소, 로컬변수)과 데이터 섹션(전역 변수), 동적으로 할당되는 메모리 힙을 포함해서 프로세스라고한다.
2. 프로세스 제어블록(PCB) : 프로세스가 CPU를 할당받아 작업을 처리하다 프로세스 전환이 발생하면 진행 상황을 모두 PCB에 저장하고 CPU 반환, 추후
재할당시 PCB 저장 정보로 종료시점 부터 작업을 다시 수행
3. PCB 저장 정보 : 프로세스 식별자(Process ID, PID), 프로세스 상태(new, ready, running, waiting, terminated), 프로그램 카운터(다음에 실행 명령어 주소), CPU 레지스터, CPU 스케쥴링 정보(프로세스 우선순위, 스케쥴 큐에 대한 포인터 등), 메모리 관리(페이지 테이블, 세그먼트 테이블 등), 입출력 상태(할당된 입출력장치, open파일 목록), 어카운팅 정보(Use CPU Time, TimeLimit, 계정 번호등)
4. 스레드 : 프로세스의 주소 공간이나 자원을 공유함, 스레드는 스레드ID, 프로그램 카운터, 레지스터 집합, 그리고 스택으로 구성된다. 같은 프로세스에 속한 다른 스레드와 코드, 데이터 섹션, 열린 파일, 신호등 OS 자원을 공유한다.
5. 하나의 프로세스를 다수의 실행 단위로 구분하여 자원을 공유하고, 자원 생성,관리의 중복을 최소화하여 수행능력을 향상 시키는 것을 멀티 스레딩이라 한다. 각 스레드는 독립 작업을 위해서 각자의 스택과 PC레지스터 값을 갖는다.
6. 스택은 함수 호출 시 전달되는 인자, 되돌아갈 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간
7. PC Register는 PC값을 저장하여 스레드가 명령어의 어디까지 수행하였는지를 나타나게 된다. 스레드는 CPU 를 할당받았다가 스케쥴러에 의해 다시 선점당한다. 그렇기 때문에 명령어가 연속적으로 수행되지 못하고 어느 부분까지 수행했는지 기억한다.

## 멀티 스레드

> 멀티 스레드, 멀티 프로세스 두가지 방법의 공통점은 여러가지 루틴을 동시에 실행하고자 한다는 것이다.

1. 멀티 스레딩은 멀티 프로세스에 비해서 메모리 공간과 시스템 자원 소모가 줄어든다. 스레드 간의 통신도 프로세스 보다 용이하게 전역 변수나 Heap으로 데이터를 주고 받을 수 있고, 스레드 context switch는 프로세스 와는 달리 캐시 메모리를 비울 필요가 없기 때문에 더 빠르다.
2. 결국 멀티 스레드 시스템이 멀티 프로세스 시스템 보다 throughtput이 향상 되고 자원 소모가 줄어들며 응답이 빠르다.
3.  멀티 스레드는 데이터와 힙 영역을 공유하기 때문에 다른 스레드에서 사용중인 변수나 자료구조에 접근하여 엉뚱한 값을 읽어오거나 수정할 수 있기에 작업 처리와 자원 접근 을 컨트롤 하는 동기화 작업이 필요하다.
4. 하지만 이로 인해 병목현상이 발생하여 성능이 저하될 가능성이 높다. 그러므로 과도한 락으로 인한 병목현상은 줄여야 한다.
5. 멀티 스레드는 멀티 프로세스 보다 적은 자원(메모리등)을 소모하고 문맥 전환이 빠르지만 하나의 스레드가 오류가 나면 다른 스레드까지 영향을 받아 종료 될 수 있다. 
6. 결국 멀티 프로세스는 안정성이 멀티 스레드보다 뛰어나며 자원소모가 심하고, 멀티 스레드는 자원 소모는 상대적으로 적은 대신 예외 상황의 안정성이나 동기화 문제 등 인프라적인 문제점이 존재한다.
